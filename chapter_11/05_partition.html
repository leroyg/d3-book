<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Pie layout</title>
		<script type="text/javascript" src="../d3/d3.v3.js"></script>
		<style type="text/css">

			text {
				font-family: sans-serif;
				font-size: 12px;
				fill: white;
			}

		</style>
	</head>
	<body>
		<script type="text/javascript">

		  var matrix =
		    {
		      "name": "All",
		      "children": [
		        {
		          "name": "business",
		          "children": [
		            {"subject": "AgglomerativeCluster", "date": 'Dec 12'},
		            {"subject": "CommunityStructure", "date": '01/01/2010'}
		          ]
		        },
		        {
		          "name": "technical",
		          "children": [
		            {"subject": "BetweennessCentrality"}
		          ]
		        },
		        {
		          "name": "others",
		          "children": [
		            {"subject": "AspectRatioBanker", "link": "http://www.google.com"}
		          ]
		        }
		      ]
		    }


			var w = 1120,
			    h = 600,
			    x = d3.scale.linear().range([0, w]),
			    y = d3.scale.linear().range([0, h]);

			var vis = d3.select("body").append("div")
			    .attr("class", "chart")
			    .style("width", w + "px")
			    .style("height", h + "px")
			  .append("svg:svg")
			    .attr("width", w)
			    .attr("height", h);

			var partition = d3.layout.partition()
			    .value(function(d) {
			    	if (d.hasOwnProperty('size')) {
							return d.size;
			    	} else {
			    		return 1;
			    	}
			    });

			var g = vis.selectAll("g")
		      .data(partition.nodes(matrix))
		    .enter().append("svg:g")
		      .attr("transform", function(d) { return "translate(" + x(d.y) + "," + y(d.x) + ")"; })
		      .on("click", click);

		  var kx = w / matrix.dx,
		      ky = h / 1;

		  g.append("svg:rect")
		      .attr("width", matrix.dy * kx)
		      .attr("height", function(d) { return d.dx * ky; })
		      .attr("class", function(d) { return d.children ? "parent" : "child"; });

			t = g.append("svg:a")
		  		.attr("xlink:href", function(d) { return d.link;} )

		  t.append("svg:text")
		      .attr("transform", transform)
		      .attr("dy", ".35em")
		      .style("opacity", function(d) { return d.dx * ky > 12 ? 1 : 0; })
		      .text(function(d) {
		        if (d.hasOwnProperty('subject')) {
		        	if (d.hasOwnProperty('date')) {
		          	return [d.subject, '(', d.date, ')'].join(" ");
		          } else {
		          	return d.subject;
		          }
		        } else {
		          return d.name;
		        };
		      })


		  d3.select(window)
		      .on("click", function() { click(matrix); })

		  function click(d) {
		    if (!d.children) return;

		    kx = (d.y ? w - 40 : w) / (1 - d.y);
		    ky = h / d.dx;
		    x.domain([d.y, 1]).range([d.y ? 40 : 0, w]);
		    y.domain([d.x, d.x + d.dx]);

		    var t = g.transition()
		        .duration(d3.event.altKey ? 7500 : 750)
		        .attr("transform", function(d) { return "translate(" + x(d.y) + "," + y(d.x) + ")"; });

		    t.select("rect")
		        .attr("width", d.dy * kx)
		        .attr("height", function(d) { return d.dx * ky; });

		    t.select("text")
		        .attr("transform", transform)
		        .style("opacity", function(d) { return d.dx * ky > 12 ? 1 : 0; });

		    d3.event.stopPropagation();
		  }

		  function transform(d) {
		    return "translate(8," + d.dx * ky / 2 + ")";
		  }
		</script>
	</body>
</html>
